{"version":3,"file":"editor.bundle.js","sources":["../src/editor.js"],"sourcesContent":["import {ObjectGUI} from \"savmaxru.objectgui\";\nimport {Tag} from 'main.core';\nimport './css/style.css'\nimport {ComponentEditor} from \"savmaxru.componenteditor\";\nimport {ComponentsGallery} from \"savmaxru.componentsgallery\";\nimport {GUIComponents} from \"savmaxru.guicomponents\";\nimport {IDManager} from 'savmaxru.idmanager';\n\nexport class Editor extends ObjectGUI\n{\n\tIDManager = new IDManager(\"editform\");\n\n\tconstructor(ID)\n\t{\n\t\tsuper();\n\t\tthis.setRootNode(\n\t\t\tTag.render`\n\t\t\t${this.addNode(\"editor-wrapper\")}`\n\t\t);\n\n\t\tthis.includeInNode(\"editor-wrapper\", Tag.render`\n\t\t<div class=\"navigation-bar\">\n\t\t\t<div class=\"a-wrapper\">\n\t\t\t\t<a class= 'nav-hide${ID}' href=\"/forms/results/${ID}\" target=\"_blank\">${BX.message(\"RESULTS\")}</a>\n\t\t\t\t<a class= 'nav-hide${ID}' href=\"/forms/view/${ID}\" target=\"_blank\">${BX.message(\"FORM_PAGE\")}</a>\n\t\t\t</div><br>\n\t\t</div>\n\t\t`);\n\n\t\tlet componentEditor = new ComponentEditor(this.getNode(\"editor-wrapper\"));\n\n\t\tlet argumentID = ID;\n\t\tif(argumentID === '0')\n\t\t{\n\t\t\targumentID = \"NEW_FORM\";\n\t\t}\n\n\t\tlet configGallery = {\n\t\t\t\"galleryClassCSS\": \"editor-gallery\",\n\t\t\t\"componentEditor\": componentEditor,\n\t\t\t\"argumentsForResult\": {\n\t\t\t\t'ID': argumentID,\n\t\t\t\tchange: 'changed',\n\t\t\t},\n\t\t};\n\n\t\tlet titleForm = GUIComponents.attach(\"SingleLineTextBox\");\n\n\t\tthis.includeInNode(\"editor-wrapper\", titleForm.getHTMLObject());\n\t\tlet gallery = new ComponentsGallery(configGallery, this, this.IDManager);\n\t\tcomponentEditor.setGallery(gallery);\n\t\tgallery.enableEditMode();\n\t\tthis.includeInNode(\"editor-wrapper\", gallery.getHTMLObject());\n\t\tlet title;\n\t\tif(ID === '0')\n\t\t{\n\t\t\t//заготовка для создания новой формы\n\t\t\tlet button = gallery.createComponentWithOption(\"Button\",'Send form');\n\t\t\ttitle = gallery.createComponentWithOption(\"Heading\",'New form');\n\t\t\tthis.includeInNode(\"editor-wrapper\", button.getHTMLObject());\n\t\t\t//сюда\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.ajax.runComponentAction('savmaxru:forms.viewform', 'sendInterviewStructure', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tidInterview: ID,\n\t\t\t\t}\n\t\t\t}).then(function (response) {\n\t\t\t\tlet formStructure = response['data']['result'];\n\t\t\t\ttitleForm.setValue(formStructure['title']);\n\t\t\t\tgallery.addObjectsGroup(formStructure,\"edit\");\n\t\t\t});\n\t\t}\n\t\tthis.includeInNode(\"editor-wrapper\", gallery.getSaveButton());\n\n\t\tlet addComponentButton = GUIComponents.attach(\"Button\");\n\t\taddComponentButton.setStyle('plus-button');\n\t\tthis.includeInNode(\"editor-wrapper\", addComponentButton.getHTMLObject());\n\n\t\tlet saveButton = GUIComponents.attach(\"Button\");\n\t\tsaveButton.build(\n\t\t\t{\n\t\t\t\t'options':[\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: BX.message(\"SAVE_FORM\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\tthis.includeInNode(\"editor-wrapper\", saveButton.getHTMLObject());\n\n\t\tsaveButton.onDown(function(){\n\t\t\tthis.getHTMLObject().innerHTML = '<div class=\"saving-button-text\">Сохраняем ...</div>';\n\t\t\tlet changes = gallery.getChanges();\n\t\t\tchanges['title'] = titleForm.getValue();\n\t\t\tBX.ajax.runComponentAction('savmaxru:forms.editor', 'saveInterviewStructure', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tresult: changes,\n\t\t\t\t}\n\t\t\t}).then(function (response) {\n\t\t\t\twindow.location = (\"\"+response['data']['IDInterview']);\n\t\t\t});\n\t\t\tconsole.log(changes);\n\t\t});\n\n\t\taddComponentButton.onDown(function(){\n\t\t\tcomponentEditor.runCreator();\n\t\t});\n\n\t}\n}"],"names":["Editor","ID","IDManager","setRootNode","Tag","render","addNode","includeInNode","BX","message","componentEditor","ComponentEditor","getNode","argumentID","configGallery","change","titleForm","GUIComponents","attach","getHTMLObject","gallery","ComponentsGallery","setGallery","enableEditMode","title","button","createComponentWithOption","ajax","runComponentAction","mode","data","idInterview","then","response","formStructure","setValue","addObjectsGroup","getSaveButton","addComponentButton","setStyle","saveButton","build","value","onDown","innerHTML","changes","getChanges","getValue","result","window","location","console","log","runCreator","ObjectGUI"],"mappings":";;;;;;;;;;;;;;;;;;;;;;KAQaA,MAAb;CAAA;;CAIC,kBAAYC,EAAZ,EACA;CAAA;;CAAA;CACC;CADD,wFAHY,IAAIC,4BAAJ,CAAc,UAAd,CAGZ;;CAEC,UAAKC,WAAL,CACCC,aAAG,CAACC,MADL,oBAEG,MAAKC,OAAL,CAAa,gBAAb,CAFH;;CAKA,UAAKC,aAAL,CAAmB,gBAAnB,EAAqCH,aAAG,CAACC,MAAzC,qBAGuBJ,EAHvB,EAGmDA,EAHnD,EAG0EO,EAAE,CAACC,OAAH,CAAW,SAAX,CAH1E,EAIuBR,EAJvB,EAIgDA,EAJhD,EAIuEO,EAAE,CAACC,OAAH,CAAW,WAAX,CAJvE;;CASA,QAAIC,eAAe,GAAG,IAAIC,wCAAJ,CAAoB,MAAKC,OAAL,CAAa,gBAAb,CAApB,CAAtB;CAEA,QAAIC,UAAU,GAAGZ,EAAjB;;CACA,QAAGY,UAAU,KAAK,GAAlB,EACA;CACCA,MAAAA,UAAU,GAAG,UAAb;CACA;;CAED,QAAIC,aAAa,GAAG;CACnB,yBAAmB,gBADA;CAEnB,yBAAmBJ,eAFA;CAGnB,4BAAsB;CACrB,cAAMG,UADe;CAErBE,QAAAA,MAAM,EAAE;CAFa;CAHH,KAApB;CASA,QAAIC,SAAS,GAAGC,oCAAa,CAACC,MAAd,CAAqB,mBAArB,CAAhB;;CAEA,UAAKX,aAAL,CAAmB,gBAAnB,EAAqCS,SAAS,CAACG,aAAV,EAArC;;CACA,QAAIC,OAAO,GAAG,IAAIC,4CAAJ,CAAsBP,aAAtB,6CAA2C,MAAKZ,SAAhD,CAAd;CACAQ,IAAAA,eAAe,CAACY,UAAhB,CAA2BF,OAA3B;CACAA,IAAAA,OAAO,CAACG,cAAR;;CACA,UAAKhB,aAAL,CAAmB,gBAAnB,EAAqCa,OAAO,CAACD,aAAR,EAArC;;CACA,QAAIK,KAAJ;;CACA,QAAGvB,EAAE,KAAK,GAAV,EACA;CACC;CACA,UAAIwB,MAAM,GAAGL,OAAO,CAACM,yBAAR,CAAkC,QAAlC,EAA2C,WAA3C,CAAb;CACAF,MAAAA,KAAK,GAAGJ,OAAO,CAACM,yBAAR,CAAkC,SAAlC,EAA4C,UAA5C,CAAR;;CACA,YAAKnB,aAAL,CAAmB,gBAAnB,EAAqCkB,MAAM,CAACN,aAAP,EAArC,EAJD;;CAMC,KAPD,MASA;CACCX,MAAAA,EAAE,CAACmB,IAAH,CAAQC,kBAAR,CAA2B,yBAA3B,EAAsD,wBAAtD,EAAgF;CAC/EC,QAAAA,IAAI,EAAE,OADyE;CAE/EC,QAAAA,IAAI,EAAE;CACLC,UAAAA,WAAW,EAAE9B;CADR;CAFyE,OAAhF,EAKG+B,IALH,CAKQ,UAAUC,QAAV,EAAoB;CAC3B,YAAIC,aAAa,GAAGD,QAAQ,CAAC,MAAD,CAAR,CAAiB,QAAjB,CAApB;CACAjB,QAAAA,SAAS,CAACmB,QAAV,CAAmBD,aAAa,CAAC,OAAD,CAAhC;CACAd,QAAAA,OAAO,CAACgB,eAAR,CAAwBF,aAAxB,EAAsC,MAAtC;CACA,OATD;CAUA;;CACD,UAAK3B,aAAL,CAAmB,gBAAnB,EAAqCa,OAAO,CAACiB,aAAR,EAArC;;CAEA,QAAIC,kBAAkB,GAAGrB,oCAAa,CAACC,MAAd,CAAqB,QAArB,CAAzB;CACAoB,IAAAA,kBAAkB,CAACC,QAAnB,CAA4B,aAA5B;;CACA,UAAKhC,aAAL,CAAmB,gBAAnB,EAAqC+B,kBAAkB,CAACnB,aAAnB,EAArC;;CAEA,QAAIqB,UAAU,GAAGvB,oCAAa,CAACC,MAAd,CAAqB,QAArB,CAAjB;CACAsB,IAAAA,UAAU,CAACC,KAAX,CACC;CACC,iBAAU,CACT;CACCC,QAAAA,KAAK,EAAElC,EAAE,CAACC,OAAH,CAAW,WAAX;CADR,OADS;CADX,KADD;;CAQA,UAAKF,aAAL,CAAmB,gBAAnB,EAAqCiC,UAAU,CAACrB,aAAX,EAArC;;CAEAqB,IAAAA,UAAU,CAACG,MAAX,CAAkB,YAAU;CAC3B,WAAKxB,aAAL,GAAqByB,SAArB,GAAiC,qDAAjC;CACA,UAAIC,OAAO,GAAGzB,OAAO,CAAC0B,UAAR,EAAd;CACAD,MAAAA,OAAO,CAAC,OAAD,CAAP,GAAmB7B,SAAS,CAAC+B,QAAV,EAAnB;CACAvC,MAAAA,EAAE,CAACmB,IAAH,CAAQC,kBAAR,CAA2B,uBAA3B,EAAoD,wBAApD,EAA8E;CAC7EC,QAAAA,IAAI,EAAE,OADuE;CAE7EC,QAAAA,IAAI,EAAE;CACLkB,UAAAA,MAAM,EAAEH;CADH;CAFuE,OAA9E,EAKGb,IALH,CAKQ,UAAUC,QAAV,EAAoB;CAC3BgB,QAAAA,MAAM,CAACC,QAAP,GAAmB,KAAGjB,QAAQ,CAAC,MAAD,CAAR,CAAiB,aAAjB,CAAtB;CACA,OAPD;CAQAkB,MAAAA,OAAO,CAACC,GAAR,CAAYP,OAAZ;CACA,KAbD;CAeAP,IAAAA,kBAAkB,CAACK,MAAnB,CAA0B,YAAU;CACnCjC,MAAAA,eAAe,CAAC2C,UAAhB;CACA,KAFD;CA9FD;CAkGC;;CAvGF;CAAA,EAA4BC,4BAA5B;;;;;;;;"}